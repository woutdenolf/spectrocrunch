# Original script from https://github.com/silx-kit/pyFAI

os:
  - linux
#  - osx

sudo: required

language: python
python:
#  - "2.6"
  - "2.7"
#  - "3.2"
#  - "3.3"
  - "3.4"
  - "3.5"

notifications:
  email: false

env:
  - CACHED_FOLDER=$HOME/cached

cache:
  directories:
  - $HOME/.cache/pip
  - $CACHED_FOLDER

branches:
  only:
  - master

addons:
  apt:
    packages:
      - curl
      - cmake
#For compiling
      - build-essential
#For shapely:
      - libgeos-dev
#For OpenCL:
      - opencl-headers
      - python-pyopencl

before_install:
  - "if [ ${TRAVIS_OS_NAME:-'linux'} = 'linux' ]; then . ./ci/before_install-linux.sh; fi"

install:
  # Upgrade/install distribution modules
  - "pip install --upgrade pip"
  # Install build dependencies with pip
  #- "pip install --upgrade -r ci/requirements_travis.txt"
  - "pip install --trusted-host www.silx.org --find-links http://www.silx.org/pub/wheelhouse/ -r ci/requirements_travis.txt --upgrade"
  # Install build dependencies without pip
  - "if [ ${TRAVIS_OS_NAME:-'linux'} = 'linux' ]; then . ./ci/install-linux.sh; fi"
  # Print Python info
  - "python ci/info_platform.py"
  - "pip list"
  # Build
  - "python setup.py build"
  - "python setup.py sdist bdist_wheel"
  # Install the generated wheel package to test it
  - "pip install --pre --no-index --find-links dist/ Spectrocrunch"

# command to run tests
script:
  - "python setup.py test"

# deploy
# deploy:
#   provider: pypi
#   user: ...
#   password: ...
#   distributions: "sdist bdist_wheel"
#   on:
#    tags: true
#    branch: master
