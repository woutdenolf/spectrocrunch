# Original script from https://github.com/silx-kit/pyFAI

os:
  - linux
#  - osx

sudo: required

language: python
python:
  - "2.7"
#  - "3.2"
#  - "3.3"
#  - "3.4"
#  - "3.5"
#  - "3.6"

notifications:
  email: false

env:
  - CACHED_FOLDER=$HOME/cached

cache:
  directories:
  - $HOME/.cache/pip
  - $CACHED_FOLDER

before_install:
  # Install CI specific build dependencies
  - cd $CACHED_FOLDER
  - "if [ ${TRAVIS_OS_NAME:-'linux'} = 'linux' ]; then . $TRAVIS_BUILD_DIR/ci/prepare_install-linux.sh; fi"

install:
  # Install general build dependencies
  - cd $CACHED_FOLDER
  - "if [ ${TRAVIS_OS_NAME:-'linux'} = 'linux' ]; then . $TRAVIS_BUILD_DIR/tools/prepare_install-linux.sh -y -t; fi"

  # Package directory  
  - cd $TRAVIS_BUILD_DIR

  # Print Python info
  - "python $TRAVIS_BUILD_DIR/ci/info_platform.py"
  - "pip list"

  # Build package
  - "python setup.py build"
  - "python setup.py sdist bdist_wheel"

  # Install package
  - "pip install --pre --no-index --find-links dist/ Spectrocrunch"

script:
  # Test the installed package
  - "python -m spectrocrunch.tests.test_all"

