# Original script from https://github.com/silx-kit/pyFAI

os:
  - linux
#  - osx

sudo: required

language: python
python:
#  - "2.6"
  - "2.7"
#  - "3.2"
#  - "3.3"
#  - "3.4"
#  - "3.5"

notifications:
  email: false

env:
  - CACHED_FOLDER=$HOME/cached

cache:
  directories:
  - $HOME/.cache/pip
  - $CACHED_FOLDER

branches:
  only:
  - master

-addons:
-  apt:
-    packages:
-      - curl
-      - wget
-      - cmake
-      - build-essential
-      - libgeos-dev
-      - opencl-headers
-      - python-pyopencl
-      - swig

before_install:
  #- "if [ ${TRAVIS_OS_NAME:-'linux'} = 'linux' ]; then . ./ci/before_install-linux.sh; fi"

install:
  # Install build dependencies and cache them
  - cd $CACHED_FOLDER
  - "if [ ${TRAVIS_OS_NAME:-'linux'} = 'linux' ]; then . $TRAVIS_BUILD_DIR/tools/prepare_installation.sh -y -t; fi"
  - cd $TRAVIS_BUILD_DIR

  # Print Python info
  - "python ci/info_platform.py"
  - "pip list"

  # Build
  - "python setup.py build"
  - "python setup.py sdist bdist_wheel"

  # Install the generated wheel package to test it
  #- "pip install --pre --no-index --find-links dist/ Spectrocrunch"
  - "python setup.py install"

# command to run tests
script:
  - "python setup.py test"

# deploy
# deploy:
#   provider: pypi
#   user: ...
#   password: ...
#   distributions: "sdist bdist_wheel"
#   on:
#    tags: true
#    branch: master
